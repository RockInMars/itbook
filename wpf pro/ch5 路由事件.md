### ch5 路由事件

路由事件可以在元素数中向上冒泡和向下隧道传播，并且沿着传播路径被事件处理程序处理。

#### 1 理解路由事件

##### 1.1 定义、注册和封装路由事件

- 使用enventmanager.registerroutedEvent()方法注册路由事件

##### 1.2 共享路由事件

- 类之间共享路由事件的定义

##### 1.3 引发路由事件

- 使用RaiseEvent()引发事件

##### 1.4 处理路由事件

- 通常约定以“元素名_事件名”的形式命名事件处理方法

#### 2 事件路由

三种路由事件处理方式

- 直接路由事件，事件发生在具体某一个元素上，不想其它元素传递
- 依次向上传递的冒泡路由事件
- 依次向下传递的隧道路由

使用EventManager.RegisterEvent()方法注册路由事件时，需要传递一个RoutingStrategy枚举值，标识事件行为

##### 2.1 routedEventargs类

- source 指示引发事件的对象
- originalSource 最初引发事件的对象，通常originalSource 与source值相同 
- routedEvent通过事件处理方法为触发事件提供routedEvent对象
- handled 允许终止冒泡或隧道传递过程的属性，如果为true，事件终止传递，也不会为其它元素引发该事件

##### 2.2 冒泡事件

##### 2.3 处理挂起事件

##### 2.4 附加事件

##### 2.5 隧道路由

#### 3 wpf事件

- 生命周期事件 元素初始化、加载、卸载时发生的事件
- 鼠标事件
- 键盘事件
- 手写笔事件
- 多点触控事件

##### 3.1 生命周期事件

- initialized事件，  当元素实例化，并已根据xaml标记设置了元素的属性之后发生，元素已经初始化，但窗口的其他部分可能未初始化，并且尚未应用样式和数据绑定。这时isinitialized为true。该事件为普通事件，不是路由事件
- loaded事件， 当整个窗口已经初始化并应用了样式和数据绑定时，该事件发生，isloaded为true。这是元素呈现前的最后一站。
- unloaded事件 当元素被释放时，该事件发生。

一个窗口相当一个元素树，当创建窗口时，元素树自下而上初始化每个元素分支，每个元素分支完成初始化，会调用各自的loaded事件。

其它windows生命事件

- sourceinitialized 当取得窗口的hwndSource属性时发生
- contentrendered 在窗口首次呈现后立即发生
- activated 当用户切换到该窗口时
- deactivated 当用户从该窗口切换到其他窗口
- closing 关闭窗口时发生，无论是用户关闭窗口，还是通过代码关闭窗口
- closed 窗口已经关闭后发生，但是在unloaded事件尚未发生之前，仍可以访问该元素对象

如果只对执行控件的第一次初始化感兴趣，最好的时机是在出发loaded事件时。

##### 3 输入事件

inputenvenArgs类

##### 4 键盘输入

- previewKeyDown 隧道路由 按下一个键时发生
- keydown 冒泡路由 按下一个键时发生
- previewTextinput 隧道路由 当按键完成并且元素正在接受文本输入时发生。对于那些不会产生文本的按键，不会引发该事件
- textinput 冒泡路由 当案件完成并且元素正在接受文本输入发生。对于那些不会产生文本的按键，不会引发该事件
- previewkeyup 隧道路由 当释放一个按键时
- keyup 冒泡路由 当释放一个按键时



